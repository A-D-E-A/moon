"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2192],{35318:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var a=n(27378);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),m=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=m(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=m(n),d=i,g=c["".concat(l,".").concat(d)]||c[d]||u[d]||o;return n?a.createElement(g,r(r({ref:t},p),{},{components:n})):a.createElement(g,r({ref:t},p))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var m=2;m<o;m++)r[m]=n[m];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},43843:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(25773),i=(n(27378),n(35318)),o=n(76911);const r={slug:"moon-v1.10",title:"moon v1.10 - Mid-year quality of life improvements",authors:["milesj"],tags:["quality","life","qol","ignore","hasher","vcs","ci","debug"],image:"./img/moon/v1.10.png"},s=void 0,l={permalink:"/blog/moon-v1.10",editUrl:"https://github.com/moonrepo/moon/tree/master/website/blog/2023-07-10_moon-v1.10.mdx",source:"@site/blog/2023-07-10_moon-v1.10.mdx",title:"moon v1.10 - Mid-year quality of life improvements",description:"Instead of launching a large feature this release, we're focusing on quality of life and developer",date:"2023-07-10T00:00:00.000Z",formattedDate:"July 10, 2023",tags:[{label:"quality",permalink:"/blog/tags/quality"},{label:"life",permalink:"/blog/tags/life"},{label:"qol",permalink:"/blog/tags/qol"},{label:"ignore",permalink:"/blog/tags/ignore"},{label:"hasher",permalink:"/blog/tags/hasher"},{label:"vcs",permalink:"/blog/tags/vcs"},{label:"ci",permalink:"/blog/tags/ci"},{label:"debug",permalink:"/blog/tags/debug"}],readingTime:3.6,hasTruncateMarker:!0,authors:[{name:"Miles Johnson",title:"Founder, developer",url:"https://github.com/milesj",imageURL:"/img/authors/miles.jpg",key:"milesj"}],frontMatter:{slug:"moon-v1.10",title:"moon v1.10 - Mid-year quality of life improvements",authors:["milesj"],tags:["quality","life","qol","ignore","hasher","vcs","ci","debug"],image:"./img/moon/v1.10.png"},nextItem:{title:"proto v0.12 - Experimental WASM plugins",permalink:"/blog/proto-v0.12"}},m={image:n(76703).Z,authorsImageUrls:[void 0]},p=[{value:"Quality improvements",id:"quality-improvements",level:2},{value:"Potential breaking changes",id:"potential-breaking-changes",level:3},{value:"Ignore hashing input files",id:"ignore-hashing-input-files",level:3},{value:"Customize base and head revision",id:"customize-base-and-head-revision",level:3},{value:"New debugging a task guide",id:"new-debugging-a-task-guide",level:2},{value:"Other changes",id:"other-changes",level:2}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Instead of launching a large feature this release, we're focusing on quality of life and developer\nexperience improvements."),(0,i.kt)("h2",{id:"quality-improvements"},"Quality improvements"),(0,i.kt)("p",null,"In the past 6 months, we've released over 16 versions of moon, with our official v1.0 release among\nthem. This is extremely impressive and we're very proud of the progress we've made. To continue this\ntrend, we'll be starting a new initiative that will land quality of life improvements (instead of\nmajor features) every 6 months, starting with this release!"),(0,i.kt)("h3",{id:"potential-breaking-changes"},"Potential breaking changes"),(0,i.kt)("p",null,"While APIs haven't changed, we have introduced some fixes for edge case that could be considered\nbreaking, but for the most part, these changes probably won't affect you. With that being said..."),(0,i.kt)("p",null,"The first fix is that tasks configured with the same ",(0,i.kt)("inlineCode",{parentName:"p"},"outputs")," location (including glob overlap)\nwill now error. This is extremely problematic for caching and hydration, as multiple tasks all\nwriting to the same output will inflate the tarball, and cause unwanted side effects. To demonstrate\nthis, the following is now an error:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="moon.yml"',title:'"moon.yml"'},"tasks:\n  build:\n    command: 'foo build'\n    outputs:\n      - 'dist'\n\n  compile:\n    command: 'bar compile'\n    outputs:\n      - 'dist'\n")),(0,i.kt)("p",null,"The other fix, which primarily applies to ",(0,i.kt)("a",{parentName:"p",href:"/docs/commands/ci"},(0,i.kt)("inlineCode",{parentName:"a"},"moon ci"))," and ",(0,i.kt)("a",{parentName:"p",href:"/docs/commands/check"},(0,i.kt)("inlineCode",{parentName:"a"},"moon check")),",\nis that a target will be skipped if one of its dependencies failed or has also been skipped.\nPreviously the target would attempt to run and most likely fail since it relied on artifacts from\nits dependencies (which don't exist). Another benefit of this change is that runs should be much\nfaster, as we're not wasting time running targets that we know will fail, which is great for CI."),(0,i.kt)("h3",{id:"ignore-hashing-input-files"},"Ignore hashing input files"),(0,i.kt)("p",null,"We're introducing 2 new settings to ",(0,i.kt)("a",{parentName:"p",href:"/docs/config/workspace"},(0,i.kt)("inlineCode",{parentName:"a"},".moon/workspace.yml"))," that'll provide\nmore control over the hashing flow, ",(0,i.kt)("a",{parentName:"p",href:"/docs/config/workspace#ignorepatterns"},(0,i.kt)("inlineCode",{parentName:"a"},"hasher.ignorePatterns")),"\nand ",(0,i.kt)("a",{parentName:"p",href:"/docs/config/workspace#ignoremissingpatterns"},(0,i.kt)("inlineCode",{parentName:"a"},"hasher.ignoreMissingPatterns")),"."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"ignorePatterns")," setting can be used to entirely ignore a file (using glob patterns) from being\nhashed, and in turn, exclude it as an input source. For example, say we want to ignore all image\nfiles."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml",metastring:'title=".moon/workspace.yml"',title:'".moon/workspace.yml"'},"hasher:\n  ignorePatterns:\n    - '**/*.{png,svg}'\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"ignoreMissingPatterns")," setting pairs with\n",(0,i.kt)("a",{parentName:"p",href:"/docs/config/workspace#warnonmissinginputs"},(0,i.kt)("inlineCode",{parentName:"a"},"hasher.warnOnMissingInputs")),". When enabled, moon will\nlog a warning to the terminal that an input is missing. This is useful for uncovering\nmisconfigurations, but can be quite noisy when inputs are truly optional. This new setting can be\nused to filter these warnings."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml",metastring:'title=".moon/workspace.yml"',title:'".moon/workspace.yml"'},"hasher:\n  warnOnMissingInputs: true\n  ignoreMissingPatterns:\n    - '**/.eslintrc.*'\n    - '**/*.config.*'\n")),(0,i.kt)("h3",{id:"customize-base-and-head-revision"},"Customize base and head revision"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"/docs/commands/ci"},(0,i.kt)("inlineCode",{parentName:"a"},"moon ci"))," command has always supported customizing the Git base and head revisions through\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"--base")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"--head")," options respectively. This was a requirement for running CI effectively,\nby comparing across branches or commits. However, the ",(0,i.kt)("a",{parentName:"p",href:"/docs/commands/run"},(0,i.kt)("inlineCode",{parentName:"a"},"moon run"))," did not support this, as\nthis command was designed to primarily be run locally, but it turns out, y'all are using it in CI\ntoo!"),(0,i.kt)("p",null,"To improve the effectiveness of ",(0,i.kt)("inlineCode",{parentName:"p"},"moon run")," in CI, we've made the following improvements, all of\nwhich require the ",(0,i.kt)("inlineCode",{parentName:"p"},"--remote")," option to be passed."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Added support for ",(0,i.kt)("inlineCode",{parentName:"li"},"MOON_BASE")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"MOON_HEAD")," environment variables, for customizing the base and\nhead revisions respectively (also supported in ",(0,i.kt)("inlineCode",{parentName:"li"},"moon ci"),"). If not defined, will use the default\nbranch and ",(0,i.kt)("inlineCode",{parentName:"li"},"HEAD"),"."),(0,i.kt)("li",{parentName:"ul"},"When the current branch is the default branch, the base revision will be the previous commit.\nUseful for commits landing on master/main.")),(0,i.kt)("h2",{id:"new-debugging-a-task-guide"},"New debugging a task guide"),(0,i.kt)("p",null,"Running tasks is the most common way to interact with moon, so what do you do when your task isn't\nworking as expected? Diagnose it of course! However, diagnosing the root cause of a broken task can\nbe quite daunting:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Is configuration wrong?"),(0,i.kt)("li",{parentName:"ul"},"What about inheritance? Or merging?"),(0,i.kt)("li",{parentName:"ul"},"Is the task platform correct?"),(0,i.kt)("li",{parentName:"ul"},"Were tokens expanded correctly?"),(0,i.kt)("li",{parentName:"ul"},"What about variable substitution?"),(0,i.kt)("li",{parentName:"ul"},"So on and so forth...")),(0,i.kt)("p",null,"To help answer these questions, we're excited to publish an\n",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/debug-task"},"in-depth guide for debugging a task"),"! These steps are the same steps we\nuse internally to diagnose reported issues, or help the Discord community. We hope you find this\nguide extremely beneficial!"),(0,i.kt)("div",{class:"flex justify-center"},(0,i.kt)(o.Z,{label:"View debugging a task guide",href:"/docs/guides/debug-task",size:"lg",mdxType:"Button"})),(0,i.kt)("h2",{id:"other-changes"},"Other changes"),(0,i.kt)("p",null,"View the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/moonrepo/moon/releases/tag/v1.10.0"},"official release")," for a full list\nof changes."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Updated ",(0,i.kt)("a",{parentName:"li",href:"/docs/commands/ci"},(0,i.kt)("inlineCode",{parentName:"a"},"moon ci"))," to include a summary of all failed actions."),(0,i.kt)("li",{parentName:"ul"},"Updated the run report to include stderr/stdout for all attempts.")))}c.isMDXComponent=!0},76703:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/v1.10-53b156788cb2d411508597208ffd8fea.png"}}]);