"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3733],{35318:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var a=n(27378);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),u=o,g=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return n?a.createElement(g,i(i({ref:t},c),{},{components:n})):a.createElement(g,i({ref:t},c))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},39016:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(25773),o=(n(27378),n(35318));const r={slug:"moon-v1.0",title:"moon v1.0 - Official release! Project constraints, tagging, and more!",authors:["milesj"],tags:["projects","constraints","tags","env-vars","tokens"],image:"./img/moon/v1.0.png"},i=void 0,s={permalink:"/blog/moon-v1.0",editUrl:"https://github.com/moonrepo/moon/tree/master/website/blog/2023-03-27_moon-v1.0.mdx",source:"@site/blog/2023-03-27_moon-v1.0.mdx",title:"moon v1.0 - Official release! Project constraints, tagging, and more!",description:"\ud83c\udf89 It's finally here! After almost a year of development, a handful of breaking changes, we've",date:"2023-03-27T00:00:00.000Z",formattedDate:"March 27, 2023",tags:[{label:"projects",permalink:"/blog/tags/projects"},{label:"constraints",permalink:"/blog/tags/constraints"},{label:"tags",permalink:"/blog/tags/tags"},{label:"env-vars",permalink:"/blog/tags/env-vars"},{label:"tokens",permalink:"/blog/tags/tokens"}],readingTime:4.745,hasTruncateMarker:!0,authors:[{name:"Miles Johnson",title:"Founder, developer",url:"https://github.com/milesj",imageURL:"/img/authors/miles.jpg",key:"milesj"}],frontMatter:{slug:"moon-v1.0",title:"moon v1.0 - Official release! Project constraints, tagging, and more!",authors:["milesj"],tags:["projects","constraints","tags","env-vars","tokens"],image:"./img/moon/v1.0.png"},prevItem:{title:"proto v0.4 - Rust support, user configs, and more",permalink:"/blog/proto-v0.4"},nextItem:{title:"proto v0.3 - Improved npm, go, and version requirement support",permalink:"/blog/proto-v0.3"}},l={image:n(37990).Z,authorsImageUrls:[void 0]},p=[{value:"The road to v1",id:"the-road-to-v1",level:2},{value:"Project boundaries with constraints",id:"project-boundaries-with-constraints",level:2},{value:"Project tagging",id:"project-tagging",level:2},{value:"Querying projects by tag",id:"querying-projects-by-tag",level:3},{value:"Enforce relationships with tags",id:"enforce-relationships-with-tags",level:3},{value:"Shells for system tasks",id:"shells-for-system-tasks",level:2},{value:"Environment variable substitution",id:"environment-variable-substitution",level:2},{value:"Date/time token variables",id:"datetime-token-variables",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}],c={toc:p};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\ud83c\udf89 It's finally here! After almost a year of development, a handful of breaking changes, we've\nofficially reached a stable v1 of moon! This release is feature packed with quality of life\nimprovements."),(0,o.kt)("h2",{id:"the-road-to-v1"},"The road to v1"),(0,o.kt)("p",null,"It's been 10 months since moon launched publicly, and since that time we have landed 501 pull\nrequests, fixed 100's of bugs, made 16 breaking changes, released 26 versions, and have been used by\ncompanies like Ikea, SumUp, Depot, and Gallery. It's been a wild ride, and we're excited to finally\nreach a stable v1 release."),(0,o.kt)("h2",{id:"project-boundaries-with-constraints"},"Project boundaries with constraints"),(0,o.kt)("p",null,"One feature that moon has not supported, but is critical for large monorepos, is project boundaries.\nA project boundary is a concept that enforces a strict relationship between projects, and is a\ncommon pattern in monorepos. For example, a project may only be allowed to depend on projects with a\n",(0,o.kt)("a",{parentName:"p",href:"#enforce-relationships-with-tags"},"specific tag"),", or a project of a specific type."),(0,o.kt)("p",null,"moon now supports this functionality through the new\n",(0,o.kt)("a",{parentName:"p",href:"/docs/config/workspace#constraints"},(0,o.kt)("inlineCode",{parentName:"a"},"constraints"))," setting in\n",(0,o.kt)("a",{parentName:"p",href:"/docs/config/workspace"},(0,o.kt)("inlineCode",{parentName:"a"},".moon/workspace.yml")),". The primary constraint we're introducing is\n",(0,o.kt)("a",{parentName:"p",href:"/docs/config/workspace#enforceprojecttyperelationships"},(0,o.kt)("inlineCode",{parentName:"a"},"enforceProjectTypeRelationships")),", which\nenforces relationships between projects based on their ",(0,o.kt)("a",{parentName:"p",href:"/docs/config/project#type"},(0,o.kt)("inlineCode",{parentName:"a"},"type"))," field."),(0,o.kt)("p",null,"For example, an application can only depend on library or tool based projects, but ",(0,o.kt)("em",{parentName:"p"},"not")," other\napplications (this is a code smell). This setting is enabled by default!"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".moon/workspace.yml"',title:'".moon/workspace.yml"'},"constraints:\n  enforceProjectTypeRelationships: true\n")),(0,o.kt)("p",null,"And that's not all, continue reading for more information on tag based constraints!"),(0,o.kt)("h2",{id:"project-tagging"},"Project tagging"),(0,o.kt)("p",null,"Everyone is familiar with the concept of tagging, and moon's implementation is no different. Tags\nare a simple mechanism for categorizing projects, and can be defined through the\n",(0,o.kt)("a",{parentName:"p",href:"/docs/config/project#tags"},(0,o.kt)("inlineCode",{parentName:"a"},"tags"))," setting in ",(0,o.kt)("a",{parentName:"p",href:"/docs/config/project"},(0,o.kt)("inlineCode",{parentName:"a"},"moon.yml")),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="moon.yml"',title:'"moon.yml"'},"tags:\n  - 'react'\n  - 'prisma'\n")),(0,o.kt)("p",null,"Tags can be used to group projects together for easier querying, enforcing of project boundaries,\napplying constraints, and more in the future. Tags will become a staple for maintaining repositories\nat scale. Continue reading for more information!"),(0,o.kt)("h3",{id:"querying-projects-by-tag"},"Querying projects by tag"),(0,o.kt)("p",null,"The first integration with tags is project querying. You can now query for projects by tag using the\nnew ",(0,o.kt)("inlineCode",{parentName:"p"},"--tags")," option in the ",(0,o.kt)("a",{parentName:"p",href:"/docs/commands/query/projects"},(0,o.kt)("inlineCode",{parentName:"a"},"moon query projects"))," command. For\nexample, say you want to find all projects that are tagged with ",(0,o.kt)("inlineCode",{parentName:"p"},"vue")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"trpc"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon query projects --tags 'vue|trpc'\n")),(0,o.kt)("h3",{id:"enforce-relationships-with-tags"},"Enforce relationships with tags"),(0,o.kt)("p",null,"Another feature of tags is enforcing relationships between projects using our new\n",(0,o.kt)("a",{parentName:"p",href:"#project-constraints"},(0,o.kt)("inlineCode",{parentName:"a"},"constraints"))," setting. When a tagged constraint is defined, it requires all\n",(0,o.kt)("a",{parentName:"p",href:"/docs/concepts/project#dependencies"},"dependencies")," of a tagged project to require 1 of the\nconfigured tags, otherwise an error is thrown during project graph creation."),(0,o.kt)("p",null,"To demonstrate this, take the following configuration:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".moon/workspace.yml" {2,3}',title:'".moon/workspace.yml"',"{2,3}":!0},"constraints:\n  tagRelationships:\n    next: ['react', 'trpc']\n")),(0,o.kt)("p",null,"This dictates that all dependencies of a project with the ",(0,o.kt)("inlineCode",{parentName:"p"},"next")," tag, must declare either ",(0,o.kt)("inlineCode",{parentName:"p"},"react"),",\n",(0,o.kt)("inlineCode",{parentName:"p"},"trpc"),", or ",(0,o.kt)("inlineCode",{parentName:"p"},"next")," in their own tags. This is great for crafting a monorepo with strict project\nboundaries!"),(0,o.kt)("h2",{id:"shells-for-system-tasks"},"Shells for system tasks"),(0,o.kt)("p",null,"Up until now, all executed tasks would not be wrapped in a shell for 1 reason, to ensure tasks are\ndeterministic. A major goal for moon is that tasks are deterministic and easily reproducible across\nall machines. Shells break this guarantee, as they can introduce subtle bugs that are difficult to\ndiagnose, and may differ wildly between developers and machines."),(0,o.kt)("p",null,"However in practice, not supporting shells has been a major pain point for many users, and for the\nmost part, most system tasks typically run common commands or execute pre-defined scripts. The\nchance of a non-deterministic build is very small. As such, we've decided to make a compromise, and\nallow shells for ",(0,o.kt)("a",{parentName:"p",href:"/docs/config/project#platform-1"},"system tasks"),", but not for language based tasks."),(0,o.kt)("p",null,"For example, the following tasks:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="moon.yml"',title:'"moon.yml"'},"tasks:\n  example:\n    command: 'echo $PWD'\n    platform: 'system'\n  global:\n    command: 'bin-on-path'\n    platform: 'system'\n")),(0,o.kt)("p",null,"Would now be executed as ",(0,o.kt)("inlineCode",{parentName:"p"},"/bin/sh -c 'echo $PWD'")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"/bin/sh -c 'bin-on-path'")," on Unix platforms\nrespectively. On Windows, we execute tasks with ",(0,o.kt)("inlineCode",{parentName:"p"},"pwsh.exe -c")," and pass arguments via stdin."),(0,o.kt)("p",null,"We're also taking this a step further, by introducing a new task option called\n",(0,o.kt)("a",{parentName:"p",href:"/docs/config/project#shell"},(0,o.kt)("inlineCode",{parentName:"a"},"shell")),", that can be used to toggle the shell wrapping on or off. When\nturned off, this allows you to customize and execute the shell as you please."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="moon.yml"',title:'"moon.yml"'},"tasks:\n  example:\n    command: 'bash -c \"echo $PWD\"'\n    platform: 'system'\n    options:\n      shell: false\n")),(0,o.kt)("h2",{id:"environment-variable-substitution"},"Environment variable substitution"),(0,o.kt)("p",null,"moon supports granular environment variables through the project-level\n",(0,o.kt)("a",{parentName:"p",href:"/docs/config/project#env"},(0,o.kt)("inlineCode",{parentName:"a"},"env"))," setting, task-level ",(0,o.kt)("a",{parentName:"p",href:"/docs/config/project#env-1"},(0,o.kt)("inlineCode",{parentName:"a"},"env"))," setting,\nand the task ",(0,o.kt)("a",{parentName:"p",href:"/docs/config/project#envfile"},(0,o.kt)("inlineCode",{parentName:"a"},"envFile"))," option. We're expanding their functionality\nwith variable substitution, allowing the value of another environment variable to be interpolated\nusing the syntax ",(0,o.kt)("inlineCode",{parentName:"p"},"${VAR_NAME}"),". This is especially useful for composing complex environment\nvariables."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="moon.yml"',title:'"moon.yml"'},"tasks:\n  dev:\n    command: 'app start'\n    env:\n      APP_TARGET: '${REGION}-${ENVIRONMENT}'\n")),(0,o.kt)("p",null,"The same substitution syntax can also be used within ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," files."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title=".env"',title:'".env"'},'APP_TARGET="${REGION}-${ENVIRONMENT}"\n')),(0,o.kt)("h2",{id:"datetime-token-variables"},"Date/time token variables"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/docs/concepts/token"},"Tokens")," are a mechanism used in task configuration for dynamically injecting\nvalues from the current project or task, especially when task inheritance is involved. Tokens have\nexisted since moon's inception, without much change... until now."),(0,o.kt)("p",null,"We're excited to introduce a new set of tokens for referencing the\n",(0,o.kt)("a",{parentName:"p",href:"/docs/concepts/token#datetime"},"current date or time"),": ",(0,o.kt)("inlineCode",{parentName:"p"},"$date"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$time"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$datetime"),", and\n",(0,o.kt)("inlineCode",{parentName:"p"},"$timestamp"),". With these new tokens, you're now able to implement clever or unusual solutions, like\ngrouping builds or deploys based on the current timestamp."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="moon.yml"',title:'"moon.yml"'},"tasks:\n  deploy:\n    command: 'app deploy --output ./build/$timestamp'\n")),(0,o.kt)("h2",{id:"other-changes"},"Other changes"),(0,o.kt)("p",null,"View the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/moonrepo/moon/releases/tag/v1.0.0"},"official release")," for a full list of\nchanges."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Added a ",(0,o.kt)("inlineCode",{parentName:"li"},"hasher.warnOnMissingInputs")," setting to ",(0,o.kt)("inlineCode",{parentName:"li"},".moon/workspace.yml"),"."),(0,o.kt)("li",{parentName:"ul"},"Added a ",(0,o.kt)("inlineCode",{parentName:"li"},"$projectAlias")," task token."),(0,o.kt)("li",{parentName:"ul"},"Added a ",(0,o.kt)("inlineCode",{parentName:"li"},"telemetry")," setting to ",(0,o.kt)("inlineCode",{parentName:"li"},".moon/workspace.yml"),"."),(0,o.kt)("li",{parentName:"ul"},"Updated the new version check to only run on the ",(0,o.kt)("inlineCode",{parentName:"li"},"check"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"ci"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"run"),", and ",(0,o.kt)("inlineCode",{parentName:"li"},"sync")," commands.")),(0,o.kt)("h2",{id:"whats-next"},"What's next?"),(0,o.kt)("p",null,"Expect the following in the v1.1 release!"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Polish and stability initiatives."),(0,o.kt)("li",{parentName:"ul"},"Task inheritance based on tags."),(0,o.kt)("li",{parentName:"ul"},"Deno tier 3 support.")))}m.isMDXComponent=!0},37990:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/v1.0-92cfbbbcd27cb6dd1411dbd29b0f1985.png"}}]);