"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7566],{5318:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return m}});var a=t(7378);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),m=o,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||r;return t?a.createElement(k,i(i({ref:n},c),{},{components:t})):a.createElement(k,i({ref:n},c))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},2502:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var a=t(5773),o=t(808),r=(t(7378),t(5318)),i=["components"],l={title:"Tokens"},s=void 0,p={unversionedId:"concepts/token",id:"concepts/token",title:"Tokens",description:"Tokens are variables and functions that can be used by args,",source:"@site/docs/concepts/token.mdx",sourceDirName:"concepts",slug:"/concepts/token",permalink:"/docs/concepts/token",draft:!1,editUrl:"https://github.com/moonrepo/moon/tree/master/website/docs/concepts/token.mdx",tags:[],version:"current",frontMatter:{title:"Tokens"},sidebar:"docs",previous:{title:"Targets",permalink:"/docs/concepts/target"},next:{title:"Cache",permalink:"/docs/concepts/cache"}},c={},u=[{value:"Functions",id:"functions",level:2},{value:"File groups",id:"file-groups",level:3},{value:"<code>@dirs</code>",id:"dirs",level:3},{value:"<code>@files</code>",id:"files",level:3},{value:"<code>@globs</code>",id:"globs",level:3},{value:"<code>@root</code>",id:"root",level:3},{value:"Inputs &amp; outputs",id:"inputs--outputs",level:3},{value:"<code>@in</code>",id:"in",level:3},{value:"<code>@out</code>",id:"out",level:3},{value:"Variables",id:"variables",level:2},{value:"<code>$project</code>",id:"project",level:3},{value:"<code>$projectSource</code>",id:"projectsource",level:3},{value:"<code>$projectRoot</code>",id:"projectroot",level:3},{value:"<code>$target</code>",id:"target",level:3},{value:"<code>$task</code>",id:"task",level:3},{value:"<code>$workspaceRoot</code>",id:"workspaceroot",level:3}],d={toc:u};function m(e){var n=e.components,t=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Tokens are variables and functions that can be used by ",(0,r.kt)("a",{parentName:"p",href:"../config/project#args"},(0,r.kt)("inlineCode",{parentName:"a"},"args")),",\n",(0,r.kt)("a",{parentName:"p",href:"../config/project#inputs"},(0,r.kt)("inlineCode",{parentName:"a"},"inputs")),", and ",(0,r.kt)("a",{parentName:"p",href:"../config/project#outputs"},(0,r.kt)("inlineCode",{parentName:"a"},"outputs"))," when configuring a\ntask. They provide a way of accessing file group paths, referencing values from other task fields,\nand referencing metadata about the project and task itself."),(0,r.kt)("h2",{id:"functions"},"Functions"),(0,r.kt)("p",null,"A token function is labeled as such as it takes a single argument, starts with an ",(0,r.kt)("inlineCode",{parentName:"p"},"@"),", and is\nformatted as ",(0,r.kt)("inlineCode",{parentName:"p"},"@name(arg)"),". The following token functions are available, grouped by their\nfunctionality."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Token functions ",(0,r.kt)("em",{parentName:"p"},"must")," be the only content within a list item, as they expand to multiple file\npaths.")),(0,r.kt)("h3",{id:"file-groups"},"File groups"),(0,r.kt)("p",null,"These functions reference file groups by name, where the name is passed as the argument."),(0,r.kt)("h3",{id:"dirs"},(0,r.kt)("inlineCode",{parentName:"h3"},"@dirs")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Usable in ",(0,r.kt)("inlineCode",{parentName:"p"},"args")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"inputs"),".")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"@dirs(file_group)")," token will be replaced with an expanded list of directory paths, derived\nfrom the file group of the same name. If a glob pattern is detected within the file group, it will\nwalk the file system and aggregate all directories found."),(0,r.kt)("p",null,"When used in ",(0,r.kt)("a",{parentName:"p",href:"../config/project#args"},(0,r.kt)("inlineCode",{parentName:"a"},"args")),", it will return relative or absolute paths, depending\non run context, while ",(0,r.kt)("a",{parentName:"p",href:"../config/project#inputs"},(0,r.kt)("inlineCode",{parentName:"a"},"inputs"))," will return absolute paths."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"fileGroups:\n  lintable:\n    - 'src'\n    - 'tests'\n    - 'scripts'\n    - '*.config.js'\n\n# Configured as\ntasks:\n  lint:\n    command: 'eslint'\n    args: '@dirs(lintable) --color'\n    inputs:\n      - '@dirs(lintable)'\n\n# Resolves to\ntasks:\n  lint:\n    command: 'eslint'\n    args:\n      - 'src'\n      - 'tests'\n      - 'scripts'\n      - '--color'\n    inputs:\n      - '/path/to/project/src'\n      - '/path/to/project/tests'\n      - '/path/to/project/scripts'\n")),(0,r.kt)("h3",{id:"files"},(0,r.kt)("inlineCode",{parentName:"h3"},"@files")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Usable in ",(0,r.kt)("inlineCode",{parentName:"p"},"args")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"inputs"),".")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"@files(file_group)")," token will be replaced with an expanded list of file paths, derived from\nthe file group of the same name. If a glob pattern is detected within the file group, it will walk\nthe file system and aggregate all files found."),(0,r.kt)("p",null,"When used in ",(0,r.kt)("a",{parentName:"p",href:"../config/project#args"},(0,r.kt)("inlineCode",{parentName:"a"},"args")),", it will return relative or absolute paths, depending\non run context, while ",(0,r.kt)("a",{parentName:"p",href:"../config/project#inputs"},(0,r.kt)("inlineCode",{parentName:"a"},"inputs"))," will return absolute paths."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"fileGroups:\n  config:\n    - '*.config.js'\n    - 'package.json'\n\n# Configured as\ntasks:\n  build:\n    command: 'webpack'\n    args: 'build @files(config)'\n    inputs:\n      - '@files(config)'\n\n# Resolves to\ntasks:\n  build:\n    command: 'webpack'\n    args:\n      - 'build'\n      - 'babel.config.js'\n      - 'webpack.config.js'\n      - 'package.json'\n    inputs:\n      - '/path/to/project/babel.config.js'\n      - '/path/to/project/webpack.config.js'\n      - '/path/to/project/package.json'\n")),(0,r.kt)("h3",{id:"globs"},(0,r.kt)("inlineCode",{parentName:"h3"},"@globs")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Usable in ",(0,r.kt)("inlineCode",{parentName:"p"},"args")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"inputs"),".")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"@globs(file_group)")," token will be replaced with an expanded list of glob patterns (as-is),\nderived from the file group of the same name. If a non-glob pattern is detected within the file\ngroup, it will be ignored."),(0,r.kt)("p",null,"When used in ",(0,r.kt)("a",{parentName:"p",href:"../config/project#args"},(0,r.kt)("inlineCode",{parentName:"a"},"args")),", it will return relative or absolute paths, depending\non run context, while ",(0,r.kt)("a",{parentName:"p",href:"../config/project#inputs"},(0,r.kt)("inlineCode",{parentName:"a"},"inputs"))," will return absolute paths ",(0,r.kt)("em",{parentName:"p"},"and")," also be\nused in affected files detection by matching against the patterns."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"fileGroups:\n  tests:\n    - 'tests/**/*'\n    - '**/__tests__/**/*'\n\n# Configured as\ntasks:\n  test:\n    command: 'jest'\n    args: '--testMatch @globs(tests)'\n    inputs:\n      - '@globs(tests)'\n\n# Resolves to\ntasks:\n  test:\n    command: 'jest'\n    args:\n      - '--testMatch'\n      - 'tests/**/*'\n      - '**/__tests__/**/*'\n    inputs:\n      - '/path/to/project/tests/**/*'\n      - '/path/to/project/**/__tests__/**/*'\n")),(0,r.kt)("h3",{id:"root"},(0,r.kt)("inlineCode",{parentName:"h3"},"@root")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Usable in ",(0,r.kt)("inlineCode",{parentName:"p"},"args")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"inputs"),".")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"@root(file_group)")," token will be replaced with the lowest common directory, derived from the\nfile group of the same name. If a glob pattern is detected within the file group, it will walk the\nfile system and aggregate all directories found before reducing."),(0,r.kt)("p",null,"When used in ",(0,r.kt)("a",{parentName:"p",href:"../config/project#args"},(0,r.kt)("inlineCode",{parentName:"a"},"args")),", it will return relative paths, while\n",(0,r.kt)("a",{parentName:"p",href:"../config/project#inputs"},(0,r.kt)("inlineCode",{parentName:"a"},"inputs"))," will return absolute paths."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"fileGroups:\n  sources:\n    - 'src/app'\n    - 'src/packages'\n    - 'src/scripts'\n\n# Configured as\ntasks:\n  format:\n    command: 'prettier'\n    args: '--write @root(sources)'\n    inputs:\n      - '@root(sources)'\n\n# Resolves to\ntasks:\n  format:\n    command: 'prettier'\n    args:\n      - '--write'\n      - 'src'\n    inputs:\n      - '/path/to/project/src'\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"When there's no directies, or too many directories, this function will return the project root\nusing ",(0,r.kt)("inlineCode",{parentName:"p"},"."),".")),(0,r.kt)("h3",{id:"inputs--outputs"},"Inputs & outputs"),(0,r.kt)("h3",{id:"in"},(0,r.kt)("inlineCode",{parentName:"h3"},"@in")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Usable in ",(0,r.kt)("inlineCode",{parentName:"p"},"args")," only.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"@in(index)")," token will be replaced with a single path, derived from\n",(0,r.kt)("a",{parentName:"p",href:"../config/project#inputs"},(0,r.kt)("inlineCode",{parentName:"a"},"inputs"))," by numerical index. If a glob pattern is referenced by index,\nthe glob will be used as-is, instead of returning the expanded list of files."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configured as\ntasks:\n  build:\n    command: 'babel'\n    args:\n      - '--copy-files'\n      - '--config-file'\n      - '@in(1)'\n      - '@in(0)'\n    inputs:\n      - 'src'\n      - 'babel.config.js'\n\n# Resolves to\ntasks:\n  build:\n    command: 'babel'\n    args:\n      - '--copy-files'\n      - '--config-file'\n      - 'babel.config.js'\n      - 'src'\n    inputs:\n      - '/path/to/project/src'\n      - '/path/to/project/babel.config.js'\n")),(0,r.kt)("h3",{id:"out"},(0,r.kt)("inlineCode",{parentName:"h3"},"@out")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Usable in ",(0,r.kt)("inlineCode",{parentName:"p"},"args")," only.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"@out(index)")," token will be replaced with a single path, derived from\n",(0,r.kt)("a",{parentName:"p",href:"../config/project#outputs"},(0,r.kt)("inlineCode",{parentName:"a"},"outputs"))," by numerical index. If a glob pattern is referenced by index,\nthe process will ",(0,r.kt)("strong",{parentName:"p"},"fail"),", as it requires literal folder and file paths."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configured as\ntasks:\n  build:\n    command: 'babel'\n    args:\n      - '.'\n      - '--out-dir'\n      - '@out(0)'\n    outputs:\n      - 'lib'\n\n# Resolves to\ntasks:\n  build:\n    command: 'babel'\n    args:\n      - '.'\n      - '--out-dir'\n      - 'lib'\n    outputs:\n      - '/path/to/project/lib'\n")),(0,r.kt)("h2",{id:"variables"},"Variables"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Usable in ",(0,r.kt)("inlineCode",{parentName:"p"},"args")," only.")),(0,r.kt)("p",null,"A token variable is a value that starts with ",(0,r.kt)("inlineCode",{parentName:"p"},"$")," and is substituted to a value derived from the\ncurrent workspace, project, and task. And unlike token functions, token variables can be placed\n",(0,r.kt)("em",{parentName:"p"},"within")," content when necessary."),(0,r.kt)("h3",{id:"project"},(0,r.kt)("inlineCode",{parentName:"h3"},"$project")),(0,r.kt)("p",null,"ID of the project that owns the currently running task, as defined in\n",(0,r.kt)("a",{parentName:"p",href:"../config/workspace"},(0,r.kt)("inlineCode",{parentName:"a"},".moon/workspace.yml")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configured as\ntasks:\n  build:\n    command: 'example'\n    args: '--project $project'\n\n# Resolves to\ntasks:\n  build:\n    command: 'example'\n    args:\n      - '--project'\n      - 'web'\n")),(0,r.kt)("h3",{id:"projectsource"},(0,r.kt)("inlineCode",{parentName:"h3"},"$projectSource")),(0,r.kt)("p",null,"Relative file path from the workspace root to the project root, as defined in\n",(0,r.kt)("a",{parentName:"p",href:"../config/workspace"},(0,r.kt)("inlineCode",{parentName:"a"},".moon/workspace.yml")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configured as\ntasks:\n  build:\n    command: 'example'\n    args:\n      - '--cache-dir'\n      - '../../.cache/$projectSource'\n\n# Resolves to\ntasks:\n  build:\n    command: 'example'\n    args:\n      - '--cache-dir'\n      - '../../.cache/apps/web'\n")),(0,r.kt)("h3",{id:"projectroot"},(0,r.kt)("inlineCode",{parentName:"h3"},"$projectRoot")),(0,r.kt)("p",null,"Absolute file path to the project root."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configured as\ntasks:\n  build:\n    command: 'example'\n    args: '--cwd $projectRoot'\n\n# Resolves to\ntasks:\n  build:\n    command: 'example'\n    args:\n      - '--cwd'\n      - '/path/to/repo/apps/web'\n")),(0,r.kt)("h3",{id:"target"},(0,r.kt)("inlineCode",{parentName:"h3"},"$target")),(0,r.kt)("p",null,"Target that is currently running. Is a combination of project and task IDs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configured as\ntasks:\n  build:\n    command: 'example'\n    args: '$target'\n\n# Resolves to\ntasks:\n  build:\n    command: 'example'\n    args:\n      - 'web:build'\n")),(0,r.kt)("h3",{id:"task"},(0,r.kt)("inlineCode",{parentName:"h3"},"$task")),(0,r.kt)("p",null,"ID of the task that is currently running."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configured as\ntasks:\n  build:\n    command: 'example'\n    args: '--task=$task'\n\n# Resolves to\ntasks:\n  build:\n    command: 'example'\n    args:\n      - '--task=build'\n")),(0,r.kt)("h3",{id:"workspaceroot"},(0,r.kt)("inlineCode",{parentName:"h3"},"$workspaceRoot")),(0,r.kt)("p",null,"Absolute file path to the workspace root."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configured as\ntasks:\n  build:\n    command: 'example'\n    args:\n      - '--cwd'\n      - '$workspaceRoot'\n\n# Resolves to\ntasks:\n  build:\n    command: 'example'\n    args:\n      - '--cwd'\n      - '/path/to/repo'\n")))}m.isMDXComponent=!0}}]);