"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[97749],{35318:(e,n,o)=>{o.d(n,{Zo:()=>p,kt:()=>f});var t=o(27378);function r(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function a(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function s(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?a(Object(o),!0).forEach((function(n){r(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function i(e,n){if(null==e)return{};var o,t,r=function(e,n){if(null==e)return{};var o,t,r={},a=Object.keys(e);for(t=0;t<a.length;t++)o=a[t],n.indexOf(o)>=0||(r[o]=e[o]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)o=a[t],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var l=t.createContext({}),c=function(e){var n=t.useContext(l),o=n;return e&&(o="function"==typeof e?e(n):s(s({},n),e)),o},p=function(e){var n=c(e.components);return t.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var o=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=c(o),f=r,u=m["".concat(l,".").concat(f)]||m[f]||d[f]||a;return o?t.createElement(u,s(s({ref:n},p),{},{components:o})):t.createElement(u,s({ref:n},p))}));function f(e,n){var o=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=o.length,s=new Array(a);s[0]=m;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var c=2;c<a;c++)s[c]=o[c];return t.createElement.apply(null,s)}return t.createElement.apply(null,o)}m.displayName="MDXCreateElement"},11558:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var t=o(25773),r=(o(27378),o(35318));const a={title:"docker scaffold",sidebar_label:"scaffold"},s=void 0,i={unversionedId:"commands/docker/scaffold",id:"commands/docker/scaffold",title:"docker scaffold",description:"The moon docker scaffold  command creates multiple repository skeletons for use",source:"@site/docs/commands/docker/scaffold.mdx",sourceDirName:"commands/docker",slug:"/commands/docker/scaffold",permalink:"/docs/commands/docker/scaffold",draft:!1,editUrl:"https://github.com/moonrepo/moon/tree/master/website/docs/commands/docker/scaffold.mdx",tags:[],version:"current",frontMatter:{title:"docker scaffold",sidebar_label:"scaffold"},sidebar:"docs",previous:{title:"prune",permalink:"/docs/commands/docker/prune"},next:{title:"setup",permalink:"/docs/commands/docker/setup"}},l={},c=[{value:"Arguments",id:"arguments",level:3},{value:"Options",id:"options",level:3},{value:"How it works",id:"how-it-works",level:2},{value:"Workspace",id:"workspace",level:3},{value:"Sources",id:"sources",level:3}],p={toc:c};function d(e){let{components:n,...o}=e;return(0,r.kt)("wrapper",(0,t.Z)({},p,o,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"moon docker scaffold <...projects>")," command creates multiple repository skeletons for use\nwithin ",(0,r.kt)("inlineCode",{parentName:"p"},"Dockerfile"),"s to effectively take advantage of Docker's layer caching. It utilizes the\n",(0,r.kt)("a",{parentName:"p",href:"../../config/workspace#projects"},"project graph")," to copy all critical files, like manifest, lockfiles, and configuration."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Scaffold a skeleton to .moon/docker\n$ moon docker scaffold <project>\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"View the official ",(0,r.kt)("a",{parentName:"p",href:"../../guides/docker"},"Docker usage guide")," for a more in-depth example of how to\nutilize this command.")),(0,r.kt)("h3",{id:"arguments"},"Arguments"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<...names>")," - List of project names or aliases to scaffold sources for, as defined in\n",(0,r.kt)("a",{parentName:"li",href:"../../config/workspace#projects"},(0,r.kt)("inlineCode",{parentName:"a"},"projects")),".")),(0,r.kt)("h3",{id:"options"},"Options"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--include")," - Additional files to include in the ",(0,r.kt)("a",{parentName:"li",href:"#sources"},"sources")," skeleton. Accepts a list of\nfile globs relative from the workspace root.")),(0,r.kt)("h2",{id:"how-it-works"},"How it works"),(0,r.kt)("p",null,"This command may seem like magic, but it's relative simple thanks to moon's infrastructure and its\nproject graph. When the command is ran, we generate 2 skeleton structures in ",(0,r.kt)("inlineCode",{parentName:"p"},".moon/docker")," (be sure\nto gitignore this). One for the workspace, and the other for sources."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"Because scaffolding uses the project graph, it requires all projects with a ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," to be\n",(0,r.kt)("a",{parentName:"p",href:"../../config/workspace#projects"},"configured in moon"),". Otherwise, moon will fail to copy all required files and builds may\nfail.")),(0,r.kt)("h3",{id:"workspace"},"Workspace"),(0,r.kt)("p",null,"The workspace skeleton mirrors the project folder structure of the repository 1:1, and only copies\nfiles required for dependencies to install. This is typically manifests (",(0,r.kt)("inlineCode",{parentName:"p"},"package.json"),"), lockfiles\n(",(0,r.kt)("inlineCode",{parentName:"p"},"yarn.lock"),", etc), other critical configs, and ",(0,r.kt)("inlineCode",{parentName:"p"},".moon")," itself. This is necessary for package\nmanagers to install dependencies (otherwise they will fail), and for dependencies to be layer cached\nin Docker."),(0,r.kt)("p",null,"An example of this skeleton using Yarn may look like the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},".moon/docker/workspace/\n\u251c\u2500\u2500 .moon/\n\u251c\u2500\u2500 .yarn/\n\u251c\u2500\u2500 apps/\n\u2502   \u251c\u2500\u2500 client/\n\u2502   \u2502   \u2514\u2500\u2500 package.json\n\u2502   \u2514\u2500\u2500 server/\n\u2502       \u2514\u2500\u2500 package.json\n\u251c\u2500\u2500 packages/\n\u2502   \u251c\u2500\u2500 foo/\n\u2502   \u2502   \u2514\u2500\u2500 package.json\n\u2502   \u251c\u2500\u2500 bar/\n\u2502   \u2502   \u2514\u2500\u2500 package.json\n\u2502   \u2514\u2500\u2500 baz/\n\u2502       \u2514\u2500\u2500 package.json\n\u251c\u2500\u2500 .yarnrc.yml\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 yarn.lock\n")),(0,r.kt)("h3",{id:"sources"},"Sources"),(0,r.kt)("p",null,"The sources skeleton is not a 1:1 mirror of the repository, and instead is the source files of a\nproject (passed as an argument to the command), and all of its dependencies. This allows\n",(0,r.kt)("a",{parentName:"p",href:"../run"},(0,r.kt)("inlineCode",{parentName:"a"},"moon run"))," and other commands to work within the ",(0,r.kt)("inlineCode",{parentName:"p"},"Dockerfile"),", and avoid having to\n",(0,r.kt)("inlineCode",{parentName:"p"},"COPY . .")," the entire repository."),(0,r.kt)("p",null,"Using our example workspace above, our sources skeleton would look like the following, assuming our\n",(0,r.kt)("inlineCode",{parentName:"p"},"client")," project is passed as an argument, and this project depends on the ",(0,r.kt)("inlineCode",{parentName:"p"},"foo")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"baz")," projects."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},".moon/docker/sources/\n\u251c\u2500\u2500 apps/\n\u2502   \u2514\u2500\u2500 client/\n|       \u251c\u2500\u2500 src/\n|       \u251c\u2500\u2500 tests/\n|       \u251c\u2500\u2500 public/\n|       \u251c\u2500\u2500 package.json\n|       \u251c\u2500\u2500 tsconfig.json\n\u2502       \u2514\u2500\u2500 (anything else)\n\u2514\u2500\u2500 packages/\n    \u251c\u2500\u2500 foo/\n    \u2502   \u251c\u2500\u2500 lib/\n    \u2502   \u251c\u2500\u2500 src/\n    \u2502   \u251c\u2500\u2500 package.json\n    \u2502   \u251c\u2500\u2500 tsconfig.json\n    \u2502   \u2514\u2500\u2500 (anything else)\n    \u2514\u2500\u2500 baz/\n        \u251c\u2500\u2500 lib/\n        \u251c\u2500\u2500 src/\n        \u251c\u2500\u2500 package.json\n        \u251c\u2500\u2500 tsconfig.json\n        \u2514\u2500\u2500 (anything else)\n")))}d.isMDXComponent=!0}}]);