"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1855],{5318:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7378);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,g=d["".concat(s,".").concat(m)]||d[m]||c[m]||r;return n?a.createElement(g,i(i({ref:t},u),{},{components:n})):a.createElement(g,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8109:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7378);function o(e){let{src:t,width:n="90%",alt:o="",title:r,align:i="center",padding:l="1rem"}=e;return a.createElement("div",{style:{marginBottom:l,marginTop:l,textAlign:i}},a.createElement("img",{src:t.default,width:n,alt:o,title:r,className:"inline-block"}))}},9619:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(7378),o=n(8944),r=n(1792);const i={failure:"bg-red-100 text-red-900",info:"bg-pink-100 text-pink-900",success:"bg-green-100 text-green-900",warning:"bg-orange-100 text-orange-900"};function l(e){let{className:t,icon:n,text:l,variant:s}=e;return a.createElement("span",{className:(0,o.Z)("inline-flex items-center px-1 py-0.5 rounded text-xs font-bold uppercase",s?i[s]:"bg-gray-100 text-gray-800",t)},n&&a.createElement(r.Z,{icon:n,className:"mr-1"}),l)}},9973:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>c});var a=n(5773),o=(n(7378),n(5318)),r=n(9619),i=n(8109);const l={slug:"v0.21",title:"moon v0.21 - Tiered language support with initial Go, PHP, Python, Ruby, and Rust",authors:["milesj"],tags:["runner","language","platform","cache","graph"],image:"./img/v0.21.png"},s=void 0,p={permalink:"/blog/v0.21",editUrl:"https://github.com/moonrepo/moon/tree/master/website/blog/2022-12-21_v0.21.mdx",source:"@site/blog/2022-12-21_v0.21.mdx",title:"moon v0.21 - Tiered language support with initial Go, PHP, Python, Ruby, and Rust",description:"Happy Holidays \ud83c\udf84\u2603\ufe0f! With our last release of the year, we're very excited to announce our tiered",date:"2022-12-21T00:00:00.000Z",formattedDate:"December 21, 2022",tags:[{label:"runner",permalink:"/blog/tags/runner"},{label:"language",permalink:"/blog/tags/language"},{label:"platform",permalink:"/blog/tags/platform"},{label:"cache",permalink:"/blog/tags/cache"},{label:"graph",permalink:"/blog/tags/graph"}],readingTime:4.275,hasTruncateMarker:!0,authors:[{name:"Miles Johnson",title:"Founder, developer",url:"https://github.com/milesj",imageURL:"https://pbs.twimg.com/profile_images/1532262885648281601/TQbEOiNd_400x400.jpg",key:"milesj"}],frontMatter:{slug:"v0.21",title:"moon v0.21 - Tiered language support with initial Go, PHP, Python, Ruby, and Rust",authors:["milesj"],tags:["runner","language","platform","cache","graph"],image:"./img/v0.21.png"},nextItem:{title:"moon v0.20 - Toolchain, caching, and hydration improvements",permalink:"/blog/v0.20"}},u={image:n(9851).Z,authorsImageUrls:[void 0]},c=[{value:"New tiered language support",id:"new-tiered-language-support",level:2},{value:"Basic support for Go, PHP, Python, Ruby, and, Rust",id:"basic-support-for-go-php-python-ruby-and-rust",level:2},{value:"Interactive project and dependency graphs",id:"interactive-project-and-dependency-graphs",level:2},{value:"New <code>--updateCache</code> command line option",id:"new---updatecache-command-line-option",level:2},{value:"New multi-status affected filtering",id:"new-multi-status-affected-filtering",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}],d={toc:c};function m(e){let{components:t,...l}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Happy Holidays \ud83c\udf84\u2603\ufe0f! With our last release of the year, we're very excited to announce our tiered\nlanguage support structure, which lays the foundation for turning moon into a multi-language build\nsystem! On top of this, we've worked heavily on bug fixing, optimizations, and overall quality of\nlife improvements."),(0,o.kt)("h2",{id:"new-tiered-language-support"},"New tiered language support"),(0,o.kt)("p",null,"The most common question we receive is whether we plan to support additional languages besides\nNode.js, with Rust, Deno, and Bun being top of that list. Adding new languages is non-trivial, as we\nneed to build abstractions that support and integrate with the language's ecosystem, primarily\ndependency managers and resolution algorithms."),(0,o.kt)("p",null,"This is a very large upfront cost, with a huge time and resource commitment. To reduce this burden,\nwe're introducing a tiered support structure, so that languages can be incrementally integrated into\nmoon and adopted by consumers."),(0,o.kt)("p",null,"The tiers break down as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\xa0",(0,o.kt)(r.Z,{text:"Tier 0",variant:"failure",mdxType:"Label"})," ","\xa0"," ",(0,o.kt)("strong",{parentName:"li"},"No direct integration")," - Tool is not\ndirectly supported in moon, but can still be ran using the\n",(0,o.kt)("a",{parentName:"li",href:"../docs/faq#can-we-run-other-languages"},'"system" task platform'),", which expects the tool to exist\nin the current environment."),(0,o.kt)("li",{parentName:"ul"},"\xa0",(0,o.kt)(r.Z,{text:"Tier 1",variant:"warning",mdxType:"Label"})," ","\xa0"," ",(0,o.kt)("strong",{parentName:"li"},"Project categorization")," - Projects can\nconfigure their primary ",(0,o.kt)("a",{parentName:"li",href:"../docs/config/project#language"},"language in ",(0,o.kt)("inlineCode",{parentName:"a"},"moon.yml")),"."),(0,o.kt)("li",{parentName:"ul"},"\xa0",(0,o.kt)(r.Z,{text:"Tier 2",variant:"info",mdxType:"Label"})," ","\xa0"," ",(0,o.kt)("strong",{parentName:"li"},"Ecosystem platformization")," - moon deeply\nintegrates with the language's ecosystem by parsing manifests, lockfiles, and other semantic files\nto infer dependencies, tasks, and other necessary information."),(0,o.kt)("li",{parentName:"ul"},"\xa0",(0,o.kt)(r.Z,{text:"Tier 3",variant:"success",mdxType:"Label"})," ","\xa0"," ",(0,o.kt)("strong",{parentName:"li"},"Toolchain integration")," - Language is\ndirectly supported in the toolchain, configured in\n",(0,o.kt)("a",{parentName:"li",href:"../docs/config/toolchain"},(0,o.kt)("inlineCode",{parentName:"a"},".moon/toolchain.yml")),", and will automatically be downloaded and\ninstalled.")),(0,o.kt)("p",null,"To learn more about our currently supported languages and their tiers,\n",(0,o.kt)("a",{parentName:"p",href:"/docs#supported-languages"},"jump to the official documentation"),"."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"One important facet we'd like to express, is that ",(0,o.kt)("em",{parentName:"p"},"all")," languages and tools fall into Tier 0. Feel\nfree to use anything you'd like as a task command!")),(0,o.kt)("h2",{id:"basic-support-for-go-php-python-ruby-and-rust"},"Basic support for Go, PHP, Python, Ruby, and, Rust"),(0,o.kt)("p",null,"As announced above, we now incrementally support new languages, and have integrated the following 5\nlanguages with Tier 1 support: Go, PHP, Python, Ruby, and, Rust! Start using these languages today\nby setting the ",(0,o.kt)("a",{parentName:"p",href:"../docs/config/project#language"},(0,o.kt)("inlineCode",{parentName:"a"},"language"))," field in ",(0,o.kt)("inlineCode",{parentName:"p"},"moon.yml"),", or by letting moon\ninfer the language based on files in the project root (for example, ",(0,o.kt)("inlineCode",{parentName:"p"},"Cargo.toml")," is Rust)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="<project>/moon.yml"',title:'"<project>/moon.yml"'},"language: 'rust'\n\ntasks:\n  build:\n    command: 'cargo build'\n    inputs:\n      - 'src/**/*'\n      - 'Cargo.toml'\n  test:\n    command: 'cargo test'\n    inputs:\n      - 'src/**/*'\n      - 'tests/**/*'\n      - 'Cargo.toml'\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Because these languages are Tier 1, moon ",(0,o.kt)("em",{parentName:"p"},"does not")," install the language automatically, and will\nrequire the command to already exist in the environment. Furthermore, the project language will\nautomatically set all task's ",(0,o.kt)("inlineCode",{parentName:"p"},"platform"),' to "system", at least until it\'s supported directly in the\ntoolchain.')),(0,o.kt)("h2",{id:"interactive-project-and-dependency-graphs"},"Interactive project and dependency graphs"),(0,o.kt)("p",null,"Thanks to the amazing contribution from ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/IgnisDa"},"Diptesh Choudhuri"),", we now have\ninteractive project and dependency graphs when running the\n",(0,o.kt)("a",{parentName:"p",href:"../docs/commands/project-graph"},(0,o.kt)("inlineCode",{parentName:"a"},"moon project-graph"))," and\n",(0,o.kt)("a",{parentName:"p",href:"../docs/commands/dep-graph"},(0,o.kt)("inlineCode",{parentName:"a"},"moon dep-graph"))," commands respectively."),(0,o.kt)("p",null,"This is only the first iteration of these graphs. Expect more advanced features in the future, like\nfiltering, node/edge inspection, exporting, and more!"),(0,o.kt)(i.Z,{src:n(7153),width:"80%",mdxType:"Image"}),(0,o.kt)("h2",{id:"new---updatecache-command-line-option"},"New ",(0,o.kt)("inlineCode",{parentName:"h2"},"--updateCache")," command line option"),(0,o.kt)("p",null,"Our caching layer is pretty powerful, as it helps to avoid tasks from running unnecessarily.\nHowever, there are situations where you need to refresh or force update the cache outside of the\n",(0,o.kt)("a",{parentName:"p",href:"../docs/config/project#inputs"},(0,o.kt)("inlineCode",{parentName:"a"},"inputs"))," list. This is currently achieved with the\n",(0,o.kt)("a",{parentName:"p",href:"../docs/commands/overview#caching"},(0,o.kt)("inlineCode",{parentName:"a"},"--cache"))," option, like ",(0,o.kt)("inlineCode",{parentName:"p"},"moon --cache off run ..."),", but this is\nnon-ideal for a few reasons:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"It disables ",(0,o.kt)("em",{parentName:"li"},"all caching"),", which means dependency installs/dedupes will continually be ran. This\nadds a lot of unwanted overhead."),(0,o.kt)("li",{parentName:"ol"},"It requires you to backspace in the terminal to add the option ",(0,o.kt)("em",{parentName:"li"},"before")," ",(0,o.kt)("inlineCode",{parentName:"li"},"run")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"check"),", as it's\na global option. A little tedious but important for experience.")),(0,o.kt)("p",null,"So to work around these limitations, we've added a new ",(0,o.kt)("inlineCode",{parentName:"p"},"--updateCache")," (or ",(0,o.kt)("inlineCode",{parentName:"p"},"-u"),") to both\n",(0,o.kt)("a",{parentName:"p",href:"../docs/commands/run"},(0,o.kt)("inlineCode",{parentName:"a"},"moon run"))," and ",(0,o.kt)("a",{parentName:"p",href:"../docs/commands/run"},(0,o.kt)("inlineCode",{parentName:"a"},"moon check")),", which will bypass\nreading any existing cache items, but will force update the cache base on the latest run."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon run app:build --updateCache\n")),(0,o.kt)("h2",{id:"new-multi-status-affected-filtering"},"New multi-status affected filtering"),(0,o.kt)("p",null,"We support running tasks based on affected files using the\n",(0,o.kt)("a",{parentName:"p",href:"../docs/commands/run"},(0,o.kt)("inlineCode",{parentName:"a"},"moon run --affected")),' command, which is great for reducing the amount of\ntasks being ran, and for applying code quality tooling like git hooks. However, you were only able\nto apply a single status filter, like "deleted" or "modified", which was non-ideal... but no more!'),(0,o.kt)("p",null,"You can now apply multiple statuses by passing the ",(0,o.kt)("inlineCode",{parentName:"p"},"--status")," option multiple times."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon run :lint --affected --status modified --status added\n")),(0,o.kt)("p",null,"This pairs nicely with the recent\n",(0,o.kt)("a",{parentName:"p",href:"../docs/config/project#affectedfiles"},(0,o.kt)("inlineCode",{parentName:"a"},"affectedFiles")," task option")," changes!"),(0,o.kt)("h2",{id:"other-changes"},"Other changes"),(0,o.kt)("p",null,"View the\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/moonrepo/moon/releases/tag/%40moonrepo%2Fcli%400.21.0"},"official release")," for a\nfull list of changes."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Refactored project and dependency graphs for improved performance."),(0,o.kt)("li",{parentName:"ul"},"Added args and env var variants to the ",(0,o.kt)("inlineCode",{parentName:"li"},"affectedFiles")," task option."),(0,o.kt)("li",{parentName:"ul"},"Added ",(0,o.kt)("inlineCode",{parentName:"li"},"--minimal")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"moon init")," for quick scaffolding and prototyping.")),(0,o.kt)("h2",{id:"whats-next"},"What's next?"),(0,o.kt)("p",null,"Expect the following in the v0.21 release!"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Scope tasks defined in ",(0,o.kt)("inlineCode",{parentName:"li"},".moon/project.yml")," to a project language or type."),(0,o.kt)("li",{parentName:"ul"},"Generalized hashing for use in any context (improved deps installation)."),(0,o.kt)("li",{parentName:"ul"},"More work on language integrations.")))}m.isMDXComponent=!0},7153:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=n.p+"assets/images/graph-0007e61b56b4bb9a3930f73c53766755.png"},9851:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/v0.21-a2807b8b9cbc5e05fe2d8cb2b78050ed.png"}}]);