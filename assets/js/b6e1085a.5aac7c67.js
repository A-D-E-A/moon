"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[89624],{29661:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>u,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var t=a(24246),r=a(71670),o=a(33337),s=a(39798);const l={slug:"v0.15",title:"moon v0.15 - Enhanced Docker support and 1,000 stars!",authors:["milesj"],tags:["generator","docker"],image:"./img/v0.15.png"},i=void 0,c={permalink:"/blog/v0.15",editUrl:"https://github.com/moonrepo/moon/tree/master/website/blog/2022-09-26_v0.15.mdx",source:"@site/blog/2022-09-26_v0.15.mdx",title:"moon v0.15 - Enhanced Docker support and 1,000 stars!",description:"With this release, we've focused heavily on Docker integration and enhancing the Dockerfile",date:"2022-09-26T00:00:00.000Z",formattedDate:"September 26, 2022",tags:[{label:"generator",permalink:"/blog/tags/generator"},{label:"docker",permalink:"/blog/tags/docker"}],readingTime:3.495,hasTruncateMarker:!0,authors:[{name:"Miles Johnson",title:"Founder, developer",url:"https://github.com/milesj",imageURL:"/img/authors/miles.jpg",key:"milesj"}],frontMatter:{slug:"v0.15",title:"moon v0.15 - Enhanced Docker support and 1,000 stars!",authors:["milesj"],tags:["generator","docker"],image:"./img/v0.15.png"},unlisted:!1,prevItem:{title:"moon v0.16 - Per-project tool versions and TypeScript improvements",permalink:"/blog/v0.16"},nextItem:{title:"moon v0.14 - Code generation and implicit dependencies",permalink:"/blog/v0.14"}},u={image:a(46496).Z,authorsImageUrls:[void 0]},d=[{value:"1,000 \u2b50\ufe0f\ud83c\udf1f\u2b50\ufe0f!",id:"1000-\ufe0f\ufe0f",level:2},{value:"First-class Docker support",id:"first-class-docker-support",level:2},{value:"Frontmatter for template files",id:"frontmatter-for-template-files",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function p(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["With this release, we've focused heavily on Docker integration and enhancing the ",(0,t.jsx)(n.code,{children:"Dockerfile"}),"\nworkflow, as well as some minor quality of life improvements for template files and run reports."]}),"\n",(0,t.jsx)(n.h2,{id:"1000-\ufe0f\ufe0f",children:"1,000 \u2b50\ufe0f\ud83c\udf1f\u2b50\ufe0f!"}),"\n",(0,t.jsxs)(n.p,{children:["Before we dive into the release, we want to thank everyone for the initial support, as we passed\n",(0,t.jsx)(n.a,{href:"https://github.com/moonrepo/moon",children:"1,000 stars on GitHub"})," earlier this week! moon was announced back\nin June, and to reach this milestone in roughly 3 months is very exciting. We greatly appreciate the\nsupport, and to everyone that is using moon and providing feedback, we thank you from the bottom of\nour hearts!"]}),"\n",(0,t.jsx)(n.p,{children:"We have a very long roadmap ahead of us, but are very excited to bring all of these features to you,\nand to improve the overall developer experience for your monorepos! Here's to 10,000 stars!"}),"\n",(0,t.jsx)(n.h2,{id:"first-class-docker-support",children:"First-class Docker support"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://www.docker.com/",children:"Docker"})," is a very popular tool that is typically a part of a developers\nworkflow, but is also a very tedious one, as ",(0,t.jsx)(n.code,{children:"Dockerfile"}),"s have to be manually curated for every\nproject. We aim to mitigate this problem by supporting Docker as a first-class feature, and by\nintroducing 2 new commands, ",(0,t.jsx)(n.a,{href:"../docs/commands/docker/scaffold",children:(0,t.jsx)(n.code,{children:"moon docker scaffold"})})," and\n",(0,t.jsx)(n.a,{href:"../docs/commands/docker/prune",children:(0,t.jsx)(n.code,{children:"moon docker prune"})}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["These commands will automate a ",(0,t.jsx)(n.code,{children:"Dockerfile"})," as much as possible to effectively take advantage of\nDocker's layer caching, multi-staged builds, to reduce the amount of manual ",(0,t.jsx)(n.code,{children:"COPY"})," commands, to\nreduce the overall size of the container or image, and much more. To demonstrate this, compare the\nbefore and after ",(0,t.jsx)(n.code,{children:"Dockerfile"}),"s below!"]}),"\n",(0,t.jsxs)(o.Z,{groupId:"dockerfile",defaultValue:"before",values:[{label:"Before",value:"before"},{label:"After",value:"after"}],children:[(0,t.jsx)(s.Z,{value:"before",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-docker",children:"FROM node:latest\n\nWORKDIR /app\n\n# Install moon binary\nRUN npm install -g @moonrepo/cli\n\n# Copy moon files\nCOPY ./.moon ./.moon\n\n# Copy all package.json's and lockfiles\nCOPY ./packages/cli/package.json ./packages/cli/package.json\nCOPY ./packages/core-linux-arm64-gnu/package.json ./packages/core-linux-arm64-gnu/package.json\nCOPY ./packages/core-linux-arm64-musl/package.json ./packages/core-linux-arm64-musl/package.json\nCOPY ./packages/core-linux-x64-gnu/package.json ./packages/core-linux-x64-gnu/package.json\nCOPY ./packages/core-linux-x64-musl/package.json ./packages/core-linux-x64-musl/package.json\nCOPY ./packages/core-macos-arm64/package.json ./packages/core-macos-arm64/package.json\nCOPY ./packages/core-macos-x64/package.json ./packages/core-macos-x64/package.json\nCOPY ./packages/core-windows-x64-msvc/package.json ./packages/core-windows-x64-msvc/package.json\nCOPY ./packages/runtime/package.json ./packages/runtime/package.json\nCOPY ./packages/types/package.json ./packages/types/package.json\nCOPY ./package.json ./package.json\nCOPY ./yarn.lock ./yarn.lock\nCOPY ./.yarn ./.yarn\nCOPY ./.yarnrc.yml ./yarnrc.yml\n\n# Install toolchain and dependencies\nRUN moon setup\n\n# Copy project and required files\nCOPY ./packages/types ./packages/types\nCOPY ./packages/runtime ./packages/runtime\n# COPY . .\n\n# Build the target\nRUN moon run runtime:build\n"})})}),(0,t.jsx)(s.Z,{value:"after",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-docker",children:"#### BASE\nFROM node:latest AS base\nWORKDIR /app\n\n# Install moon binary\nRUN npm install -g @moonrepo/cli\n\n#### WORKSPACE\nFROM base AS workspace\nWORKDIR /app\n\n# Copy entire repository and scaffold\nCOPY . .\nRUN moon docker scaffold runtime\n\n#### BUILD\nFROM base AS build\nWORKDIR /app\n\n# Copy workspace skeleton\nCOPY --from=workspace /app/.moon/docker/workspace .\n\n# Install toolchain and dependencies\nRUN moon setup\n\n# Copy source files\nCOPY --from=workspace /app/.moon/docker/sources .\n\n# Build the target\nRUN moon run runtime:build\n\n# Prune workspace\nRUN moon docker prune\n"})})})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["View the official ",(0,t.jsx)(n.a,{href:"../docs/guides/docker",children:"Docker usage guide"})," for an in-depth walkthrough of all\nthese new features!"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"frontmatter-for-template-files",children:"Frontmatter for template files"}),"\n",(0,t.jsxs)(n.p,{children:["We released ",(0,t.jsx)(n.a,{href:"./v0.14",children:"templates and the generator in v0.14"})," for quick and easy code generation.\nSince it was the initial release, it provided the bare minimum of features for common workflows.\nWe'll continually improve this system over each release, and have done just that for this release,\nas all template files now support ",(0,t.jsx)(n.a,{href:"../docs/guides/codegen#frontmatter",children:"frontmatter"}),"! Frontmatter is\na mechanism for declaring ",(0,t.jsx)(n.em,{children:"per-file configuration"}),", and is denoted by ",(0,t.jsx)(n.code,{children:"---"})," delimiters at the top of\nthe file."]}),"\n",(0,t.jsxs)(n.p,{children:["This allows you to do some really cool stuff, like overriding the destination path of the file using\nthe ",(0,t.jsx)(n.code,{children:"to"})," field, as well as taking full advantage of Tera's filters and conditional rendering!"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-twig",metastring:'title="templates/react/components/base.tsx"',children:"{% set component_name = name | pascal_case %}\n\n---\nto: components/{{ component_name }}.tsx\n---\n\nexport function {{ component_name }}() {\n\treturn <div />;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,t.jsxs)(n.p,{children:["View the\n",(0,t.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/%40moonrepo%2Fcli%400.15.0",children:"official release"})," for a\nfull list of changes."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Run reports (via ",(0,t.jsx)(n.code,{children:"--report"}),") now include additional information, like the total duration, and\nestimated time savings.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.a,{href:"https://github.com/marketplace/actions/moon-ci-run-reports",children:"moonrepo/run-report-action"})," has\nbeen updated with this information."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Improved pnpm integration for Go/Rust binaries shipped in node modules."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,t.jsx)(n.p,{children:"Expect the following in the v0.16 release!"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Quality of life improvements for TypeScript."}),"\n",(0,t.jsx)(n.li,{children:"Per-project overrides for language/tool versions."}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},39798:(e,n,a)=>{a.d(n,{Z:()=>s});a(27378);var t=a(37140);const r={tabItem:"tabItem_wHwb"};var o=a(24246);function s(e){let{children:n,hidden:a,className:s}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,t.Z)(r.tabItem,s),hidden:a,children:n})}},33337:(e,n,a)=>{a.d(n,{Z:()=>m});var t=a(27378),r=a(37140),o=a(83457),s=a(35595),l=a(76457);const i={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var c=a(24246);function u(e){let{className:n,block:a,selectedValue:t,selectValue:s,tabValues:l}=e;const u=[],{blockElementScrollPositionUntilNextRender:d}=(0,o.o5)(),p=e=>{const n=e.currentTarget,a=u.indexOf(n),r=l[a].value;r!==t&&(d(n),s(r))},m=e=>{let n=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const a=u.indexOf(e.currentTarget)+1;n=u[a]??u[0];break}case"ArrowLeft":{const a=u.indexOf(e.currentTarget)-1;n=u[a]??u[u.length-1];break}}n?.focus()};return(0,c.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":a},n),children:l.map((e=>{let{value:n,label:a,attributes:o}=e;return(0,c.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>u.push(e),onKeyDown:m,onClick:p,...o,className:(0,r.Z)("tabs__item",i.tabItem,o?.className,{"tabs__item--active":t===n}),children:a??n},n)}))})}function d(e){let{lazy:n,children:a,selectedValue:r}=e;const o=(Array.isArray(a)?a:[a]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===r));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,c.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function p(e){const n=(0,s.Y)(e);return(0,c.jsxs)("div",{className:(0,r.Z)("tabs-container",i.tabList),children:[(0,c.jsx)(u,{...e,...n}),(0,c.jsx)(d,{...e,...n})]})}function m(e){const n=(0,l.Z)();return(0,c.jsx)(p,{...e,children:(0,s.h)(e.children)},String(n))}},35595:(e,n,a)=>{a.d(n,{Y:()=>m,h:()=>c});var t=a(27378),r=a(3620),o=a(9834),s=a(30654),l=a(70784),i=a(71819);function c(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:a}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return c(e).map((e=>{let{props:{value:n,label:a,attributes:t,default:r}}=e;return{value:n,label:a,attributes:t,default:r}}))}(a);return function(e){const n=(0,l.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,a])}function d(e){let{value:n,tabValues:a}=e;return a.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:a}=e;const o=(0,r.k6)(),l=function(e){let{queryString:n=!1,groupId:a}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:n,groupId:a});return[(0,s._X)(l),(0,t.useCallback)((e=>{if(!l)return;const n=new URLSearchParams(o.location.search);n.set(l,e),o.replace({...o.location,search:n.toString()})}),[l,o])]}function m(e){const{defaultValue:n,queryString:a=!1,groupId:r}=e,s=u(e),[l,c]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!d({value:n,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=a.find((e=>e.default))??a[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:s}))),[m,h]=p({queryString:a,groupId:r}),[f,g]=function(e){let{groupId:n}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,o]=(0,i.Nk)(a);return[r,(0,t.useCallback)((e=>{a&&o.set(e)}),[a,o])]}({groupId:r}),k=(()=>{const e=m??f;return d({value:e,tabValues:s})?e:null})();(0,o.Z)((()=>{k&&c(k)}),[k]);return{selectedValue:l,selectValue:(0,t.useCallback)((e=>{if(!d({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);c(e),h(e),g(e)}),[h,g,s]),tabValues:s}}},46496:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/v0.15-df3082f5cae38090b567718791719d91.png"},71670:(e,n,a)=>{a.d(n,{Z:()=>l,a:()=>s});var t=a(27378);const r={},o=t.createContext(r);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);